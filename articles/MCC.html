<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="MCC">
<title>MCC overview • MCC</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="MCC overview">
<meta property="og:description" content="MCC">
<meta property="og:image" content="https://tjuheide.github.io/MCC/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MCC</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/MCC.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tjuheide/MCC/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>MCC overview</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tjuheide/MCC/blob/HEAD/vignettes/MCC.Rmd" class="external-link"><code>vignettes/MCC.Rmd</code></a></small>
      <div class="d-none name"><code>MCC.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tjuheide/MCC" class="external-link">MCC</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://adibender.github.io/pammtools/" class="external-link">pammtools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># colors from the wesanderson package/Royal1-palette used for plots</span></span>
<span><span class="va">mypal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#899da4"</span>, <span class="st">"#c93312"</span><span class="op">)</span></span></code></pre></div>
<p>The purpose of the MCC package is to compute the mean cumulative
count (see <a href="https://doi.org/10.1093/aje/kwu289" class="external-link uri">https://doi.org/10.1093/aje/kwu289</a>) of events when these
can happen repeatedly during follow-up.</p>
<p>The mcc-function allows for weights, which are assumed to be constant
throughout follow-up for the individual.</p>
<p>Below is an example using built in data (not representing any real
population, exposure, or outcome).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># load built in data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"mcc_events"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># data on times and recurrent events within an exposure and control group.</span></span>
<span><span class="co"># A weight is provided to balance measured covariates (covariates not provided)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">mcc_events</span><span class="op">)</span></span>
<span><span class="co">#&gt; Classes 'data.table' and 'data.frame':   2165 obs. of  5 variables:</span></span>
<span><span class="co">#&gt;  $ id    : Factor w/ 1000 levels "1","2","3","4",..: 1 1 1 1 2 2 3 3 4 5 ...</span></span>
<span><span class="co">#&gt;  $ grp   : Factor w/ 2 levels "Control","Exposed": 2 2 2 2 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ weight: num  0.907 0.907 0.907 0.907 0.892 ...</span></span>
<span><span class="co">#&gt;  $ time  : num  1.63 1.66 2.16 3.09 3.04 ...</span></span>
<span><span class="co">#&gt;  $ event : int  1 1 1 2 1 0 1 0 0 1 ...</span></span>
<span><span class="co">#&gt;  - attr(*, ".internal.selfref")=&lt;externalptr&gt;</span></span></code></pre></div>
<p>MCC expects data with one observation per event per individual,
including an observation at the end of follow-up, i.e., for all
individuals there must be a censoring (coded 0) or competing event
(coded 2) and this must happen at their last time of follow-up. There
can also be an event of interest at this time.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># most observations will probably have events at distinct times and either be</span></span>
<span><span class="co"># censored or die/get a competing event at the last time without an event there.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mcc_events</span>,<span class="fl">9</span><span class="op">)</span></span>
<span><span class="co">#&gt;        id     grp    weight     time event</span></span>
<span><span class="co">#&gt;    &lt;fctr&gt;  &lt;fctr&gt;     &lt;num&gt;    &lt;num&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:      1 Exposed 0.9065762 1.632877     1</span></span>
<span><span class="co">#&gt; 2:      1 Exposed 0.9065762 1.663014     1</span></span>
<span><span class="co">#&gt; 3:      1 Exposed 0.9065762 2.156164     1</span></span>
<span><span class="co">#&gt; 4:      1 Exposed 0.9065762 3.087671     2</span></span>
<span><span class="co">#&gt; 5:      2 Control 0.8924532 3.038356     1</span></span>
<span><span class="co">#&gt; 6:      2 Control 0.8924532 5.000000     0</span></span>
<span><span class="co">#&gt; 7:      3 Control 1.0718638 1.865753     1</span></span>
<span><span class="co">#&gt; 8:      3 Control 1.0718638 5.000000     0</span></span>
<span><span class="co">#&gt; 9:      4 Control 0.9049045 5.000000     0</span></span>
<span></span>
<span></span>
<span><span class="co"># however, it can happen that an individual gets an event and is either</span></span>
<span><span class="co"># censored or die at the same observed time. This is not an issue.</span></span>
<span><span class="va">mcc_events</span><span class="op">[</span><span class="va">id</span> <span class="op">==</span> <span class="fl">603</span><span class="op">]</span></span>
<span><span class="co">#&gt;        id     grp   weight     time event</span></span>
<span><span class="co">#&gt;    &lt;fctr&gt;  &lt;fctr&gt;    &lt;num&gt;    &lt;num&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:    603 Exposed 0.982151 3.290411     0</span></span>
<span><span class="co">#&gt; 2:    603 Exposed 0.982151 3.290411     1</span></span></code></pre></div>
<p>The checkData-function can be used to check for obvious errors in the
data:<br>
- events must be coded 0, 1, 2;<br>
- the last observation for the individual must be either 0 or 2;<br>
- intermediate events must be 1;<br>
- time must be non-negative;<br>
- if weights are applied they must be constant throughout follow-up If
the function returns NULL then it did not detect any obvious errors.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check integrity of data</span></span>
<span><span class="fu"><a href="../reference/checkData.html">checkData</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mcc_events</span>,</span>
<span>          idvar <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>          timevar <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>          eventvar <span class="op">=</span> <span class="st">"event"</span>,</span>
<span>          weightvar <span class="op">=</span> <span class="st">"weight"</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>The data can be analyzed using the mcc-function. This returns
estimates of the mean cumulative count for each time point observed
within the specific group.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># estimating the mean cumulative count within groups using the mcc-function</span></span>
<span><span class="va">estimate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcc.html">mcc</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mcc_events</span>,</span>
<span>                idvar <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>                timevar <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>                eventvar <span class="op">=</span> <span class="st">"event"</span>,</span>
<span>                grpvar <span class="op">=</span> <span class="st">"grp"</span>,</span>
<span>                weightvar <span class="op">=</span> <span class="st">"weight"</span><span class="op">)</span></span></code></pre></div>
<p>To get a measure of variability, bootstrap samples from a built in
data set are used (500 samples).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># loading built in data on with bootstrap samples</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"mcc_events_bs"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># BootstrapSample and grp are combined so that only one call of the</span></span>
<span><span class="co"># mcc-function is necessary, grouping by the new variable</span></span>
<span><span class="va">mcc_events_bs</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">mcc_events_bs</span><span class="op">$</span><span class="va">grp</span>,<span class="va">mcc_events_bs</span><span class="op">$</span><span class="va">BootstrapSample</span>,</span>
<span>                             sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># the mcc-function is used within groups in each bootstrap sample</span></span>
<span><span class="va">bsestimate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcc.html">mcc</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mcc_events_bs</span>,</span>
<span>                  id <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>                  time <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>                  event <span class="op">=</span> <span class="st">"event"</span>,</span>
<span>                  grp <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>                  weight <span class="op">=</span> <span class="st">"weight"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># note that the name of the group variable is grp, regardless of the name in the</span></span>
<span><span class="co"># input data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">bsestimate</span><span class="op">)</span></span>
<span><span class="co">#&gt; Classes 'data.table' and 'data.frame':   425664 obs. of  8 variables:</span></span>
<span><span class="co">#&gt;  $ grp              : chr  "Control-1" "Control-1" "Control-1" "Control-1" ...</span></span>
<span><span class="co">#&gt;  $ time             : num  0 0 0.00274 0.01918 0.0274 ...</span></span>
<span><span class="co">#&gt;  $ atrisk           : num  514 514 514 514 514 ...</span></span>
<span><span class="co">#&gt;  $ km               : num  1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ mcc              : num  0 0.00202 0.00418 0.00616 0.00814 ...</span></span>
<span><span class="co">#&gt;  $ censored         : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ event_of_interest: num  0 1.04 1.11 1.02 1.02 ...</span></span>
<span><span class="co">#&gt;  $ competing_event  : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  - attr(*, ".internal.selfref")=&lt;externalptr&gt;</span></span></code></pre></div>
<p>In order to be able to compare the two groups at any given time point
(observed or specified), and to have the same number of bootstrap
estimates at each time point, the expandMCC-function is called. This
makes an observation at all observed time points (across groups) and at
time points specified in the function call in all groups.</p>
<p>Note that estimates will not be provided for time points coming after
the last observation in a specific group. I.e., if in group A an event
happens at time 10, but in group B no one is followed beyond time 8,
then no estimate at time 10 will be provided in group B. If
bootstrapping is applied, this may result in fewer bootstrap estimates
at late follow-up, if only few individuals are followed for a long time.
If follow-up is generally shorter than 5 years, say, and only one
individual is followed for longer, then for bootstrap samples not
including this individual, there will be no estimate beyond 5 years.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># expandMCC is used to get an estimate at all observed times and at time 1-6</span></span>
<span><span class="co"># (if time 1-6 is already seen in the data, this will add nothing).</span></span>
<span><span class="co"># NB the longest observed time is 5, thus asking for a estimate at time 6 will</span></span>
<span><span class="co"># return a warning, and no estimate will be supplied in the output</span></span>
<span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expandMCC.html">expandMCC</a></span><span class="op">(</span>mcc_est <span class="op">=</span> <span class="va">estimate</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Warning:"</span></span>
<span><span class="co">#&gt; [1] "A specified time point exceeds the follow-up in a group."</span></span>
<span><span class="co">#&gt; [1] "Estimates beyond the observed follow-up will not be made."</span></span>
<span></span>
<span></span>
<span><span class="co"># (only times 1-5 requested in the bootstrap samples)</span></span>
<span><span class="va">bs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expandMCC.html">expandMCC</a></span><span class="op">(</span>mcc_est <span class="op">=</span> <span class="va">bsestimate</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># variables BootstrapSample and grp are recreated from grp</span></span>
<span><span class="va">bs</span><span class="op">$</span><span class="va">BootstrapSample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">'.*-'</span>, <span class="st">''</span>, <span class="va">bs</span><span class="op">$</span><span class="va">grp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bs</span><span class="op">$</span><span class="va">grp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/startsWith.html" class="external-link">startsWith</a></span><span class="op">(</span><span class="va">bs</span><span class="op">$</span><span class="va">grp</span>, <span class="st">"Control"</span><span class="op">)</span>, <span class="st">"Control"</span>, <span class="st">"Exposed"</span><span class="op">)</span>,</span>
<span>                 levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="st">"Exposed"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Combining the results from the bootstrap samples and the actual data
makes it possible to plot MCC against time, and report estimates with
95% CIs at specific times.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># estimating 95% CI at every time point based on the sampling (bootstrap)</span></span>
<span><span class="co"># distribution</span></span>
<span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="va">bs</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>lcl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">mcc</span>, <span class="fl">.025</span><span class="op">)</span>, ucl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">mcc</span>, <span class="fl">.975</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grp"</span>, <span class="st">"time"</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="va">est</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grp"</span>, <span class="st">"time"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="co"># plotting the mean cumulative count with 95% CI-bands against time</span></span>
<span><span class="co"># for the 2 groups</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cl</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">mcc</span>, color <span class="op">=</span> <span class="va">grp</span>, fill <span class="op">=</span> <span class="va">grp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://adibender.github.io/pammtools/reference/geom_stepribbon.html" class="external-link">geom_stepribbon</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.25</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lcl</span>, ymax <span class="op">=</span> <span class="va">ucl</span>, color <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>                  show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">mypal</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">mypal</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">"Time"</span>, title <span class="op">=</span> <span class="st">"Mean cumulative count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span><span class="op">)</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.2</span>,<span class="fl">.85</span><span class="op">)</span>,</span>
<span>        legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="MCC_files/figure-html/unnamed-chunk-8-1.png" width="480"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="co"># yearly MCC estimates within groups</span></span>
<span><span class="va">cl</span><span class="op">[</span><span class="va">time</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span>, <span class="fu">.</span><span class="op">(</span><span class="va">grp</span>, <span class="va">time</span>, <span class="va">mcc</span>, <span class="va">lcl</span>, <span class="va">ucl</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;         grp  time       mcc       lcl       ucl</span></span>
<span><span class="co">#&gt;      &lt;fctr&gt; &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1: Control     1 0.3819464 0.3272210 0.4352758</span></span>
<span><span class="co">#&gt;  2: Control     2 0.7976654 0.7111200 0.8861932</span></span>
<span><span class="co">#&gt;  3: Control     3 1.1507593 1.0463561 1.2569894</span></span>
<span><span class="co">#&gt;  4: Control     4 1.3974719 1.2856592 1.5032377</span></span>
<span><span class="co">#&gt;  5: Control     5 1.6509666 1.5247917 1.7844171</span></span>
<span><span class="co">#&gt;  6: Exposed     1 0.2142607 0.1702317 0.2547290</span></span>
<span><span class="co">#&gt;  7: Exposed     2 0.4113603 0.3467663 0.4702224</span></span>
<span><span class="co">#&gt;  8: Exposed     3 0.5864469 0.5151989 0.6532670</span></span>
<span><span class="co">#&gt;  9: Exposed     4 0.7102156 0.6357852 0.7807951</span></span>
<span><span class="co">#&gt; 10: Exposed     5 0.8252094 0.7426318 0.9022471</span></span></code></pre></div>
<p>The groups can be compared to quantify differences. Here a mean
cumulative count ratio is computed and plotted against time, and
tabulated yearly.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># computing the MCC ratio</span></span>
<span><span class="va">mccratio</span> <span class="op">&lt;-</span> <span class="va">est</span><span class="op">[</span><span class="va">grp</span> <span class="op">==</span> <span class="st">"Exposed"</span> <span class="op">&amp;</span> <span class="va">time</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span><span class="op">[</span></span>
<span>  <span class="va">est</span><span class="op">[</span><span class="va">grp</span> <span class="op">!=</span> <span class="st">"Exposed"</span> <span class="op">&amp;</span> <span class="va">time</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span>,on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"time"</span><span class="op">)</span>,</span>
<span>  <span class="fu">.</span><span class="op">(</span><span class="va">time</span>, ratio <span class="op">=</span> <span class="va">mcc</span> <span class="op">/</span> <span class="va">i.mcc</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">clratio</span> <span class="op">&lt;-</span> <span class="va">bs</span><span class="op">[</span><span class="va">grp</span> <span class="op">==</span> <span class="st">"Exposed"</span> <span class="op">&amp;</span> <span class="va">time</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span><span class="op">[</span></span>
<span>  <span class="va">bs</span><span class="op">[</span><span class="va">grp</span> <span class="op">!=</span> <span class="st">"Exposed"</span> <span class="op">&amp;</span> <span class="va">time</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span>,on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"time"</span>, <span class="st">"BootstrapSample"</span><span class="op">)</span>,</span>
<span>  <span class="fu">.</span><span class="op">(</span><span class="va">time</span>, ratio <span class="op">=</span> <span class="va">mcc</span> <span class="op">/</span> <span class="va">i.mcc</span><span class="op">)</span></span>
<span>  <span class="op">]</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>lcl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">ratio</span>, <span class="fl">.025</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>        ucl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">ratio</span>, <span class="fl">.975</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">time</span></span>
<span>    <span class="op">]</span><span class="op">[</span><span class="va">mccratio</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"time"</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">ucl</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">lcl</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="co"># plotting the ratio against time</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">clratio</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">ratio</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lcl</span>, ymax <span class="op">=</span> <span class="va">ucl</span><span class="op">)</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">.25</span>, color <span class="op">=</span> <span class="st">"transparent"</span>, fill <span class="op">=</span> <span class="va">mypal</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1.5</span>, color <span class="op">=</span> <span class="va">mypal</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.25</span>,<span class="fl">.5</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.15</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">"Time"</span>, title <span class="op">=</span> <span class="st">"Mean cumulative count ratio"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="MCC_files/figure-html/unnamed-chunk-9-1.png" width="480"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="co"># yearly MCC ratios</span></span>
<span><span class="va">clratio</span><span class="op">[</span><span class="va">time</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span>, <span class="fu">.</span><span class="op">(</span><span class="va">time</span>, <span class="va">ratio</span>, <span class="va">lcl</span>, <span class="va">ucl</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;     time     ratio       lcl       ucl</span></span>
<span><span class="co">#&gt;    &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     1 0.5609704 0.4304832 0.6999795</span></span>
<span><span class="co">#&gt; 2:     2 0.5157053 0.4249083 0.6067041</span></span>
<span><span class="co">#&gt; 3:     3 0.5096174 0.4373435 0.5826434</span></span>
<span><span class="co">#&gt; 4:     4 0.5082146 0.4411198 0.5770182</span></span>
<span><span class="co">#&gt; 5:     5 0.4998341 0.4366818 0.5615709</span></span></code></pre></div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Uffe Heide-Jørgensen.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
